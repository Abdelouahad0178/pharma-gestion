src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AdminPopup.js                 âœ… NOUVEAU
â”‚   â”œâ”€â”€ AccountLocked.js              âœ… NOUVEAU
â”‚   â””â”€â”€ PaymentWarningBanner.js       âœ… NOUVEAU
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useFirestore.js               âœ… NOUVEAU
â””â”€â”€ contexts/
    â””â”€â”€ UserRoleContext.js            ðŸ”„ MODIFIÃ‰
Fichiers Ã  Modifier
src/
â”œâ”€â”€ App.js                            ðŸ”„ MODIFIÃ‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Protected.js                  ðŸ”„ MODIFIÃ‰
â”‚   â””â”€â”€ dashboard/Dashboard.js        ðŸ”„ MODIFIÃ‰ 


https://claude.ai/share/98d742bd-9f02-4f75-a5d1-40120ab66c8e//abonnement paypal


https://claude.ai/chat/896e723f-d20c-4a2f-a5cd-b359b0bf6b69// formes juridiques



rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /* ============== Helpers ============== */
    function signedIn() {
      return request.auth != null;
    }

    function me() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid));
    }

    function mySocieteId() {
      return signedIn() ? me().data.societeId : null;
    }

    function sameSoc(sid) {
      return signedIn() && mySocieteId() == sid;
    }

    // ---- RÃ´les & ownership
    function isOwnerOf(sid) {
      return signedIn()
        && get(/databases/$(database)/documents/societe/$(sid)).data.ownerUid == request.auth.uid;
    }

    function myRole() {
      return me().data.role;
    }

    function isAdminLike() {
      // adapte si tu veux inclure dâ€™autres rÃ´les
      return myRole() in ['admin', 'pharmacien', 'docteur'];
    }

    function isVendeuse() {
      return myRole() == 'vendeuse';
    }

    // ---- Admin/Owner de la sociÃ©tÃ©
    function isOwnerOrAdminOf(sid) {
      return sameSoc(sid) && (isOwnerOf(sid) || isAdminLike());
    }

    /* ============== users/{uid} ============== */
    match /users/{uid} {

      // Lire : soi-mÃªme OU mÃªme sociÃ©tÃ©
      allow read: if signedIn() && (
        request.auth.uid == uid ||
        (resource.data.societeId != null && resource.data.societeId == mySocieteId())
      );

      // CrÃ©er : soi-mÃªme
      allow create: if signedIn() && request.auth.uid == uid;

      // Mettre Ã  jour :
      // - soi-mÃªme, OU
      // - owner/admin de la mÃªme sociÃ©tÃ© que la cible.
      //   Pour couvrir la "restauration" (re-attacher un user), on accepte si
      //   resource.societeId == mySocieteId() OU request.resource.societeId == mySocieteId().
      allow update: if signedIn() && (
        request.auth.uid == uid ||
        (
          (
            (resource.data.societeId != null && resource.data.societeId == mySocieteId()) ||
            (request.resource.data.societeId != null && request.resource.data.societeId == mySocieteId())
          )
          && isOwnerOrAdminOf(mySocieteId())
        )
      );

      // Supprimer : soi-mÃªme OU owner/admin de la mÃªme sociÃ©tÃ© que la cible
      allow delete: if signedIn() && (
        request.auth.uid == uid ||
        (resource.data.societeId != null && resource.data.societeId == mySocieteId() && isOwnerOrAdminOf(mySocieteId()))
      );
    }

    /* ============== societe/{sid} ============== */
    match /societe/{sid} {
      // Lire : membres de la sociÃ©tÃ©
      allow read: if sameSoc(sid);

      // CrÃ©er : nâ€™importe quel user connectÃ© peut crÃ©er SA sociÃ©tÃ© sâ€™il se met ownerUid
      allow create: if signedIn() && request.resource.data.ownerUid == request.auth.uid;

      // Mettre Ã  jour / supprimer : owner uniquement
      allow update, delete: if isOwnerOf(sid) && sameSoc(sid);

      // Sous-collections : accÃ¨s complet aux membres (comme chez toi)
      match /{sub=**} {
        allow read, write: if sameSoc(sid);
      }
    }

    /* ============== invitations/{token} ============== */
    match /invitations/{token} {
      allow read: if signedIn();
      allow create, update, delete: if signedIn();
    }
  }
}